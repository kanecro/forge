# Core Essentials

常時読み込みされる最小限のルール。詳細は `~/.claude/reference/` を必要に応じて参照。

---

## エスカレーションポリシー

### 必須エスカレーション（`AskUserQuestion` で確認）

- **セキュリティ**: 認証・認可ロジックの設計・変更、暗号化方式の選択、PII処理方法
- **データ**: DBスキーマ変更、マイグレーション戦略、データ整合性に影響する変更
- **アーキテクチャ**: 新サービス・新モジュール追加、破壊的API変更、レイヤー構成変更
- **本番環境**: デプロイ設定、環境変数変更、ロールバック手順

### 状況依存エスカレーション（自信がなければ確認）

- 仕様の曖昧性・複数解釈が可能な場合
- 技術的に同等な複数アプローチの選択
- スコープ外の関連変更が必要になった場合

### 自律判断OK

- コードフォーマット、lint修正、ローカル変数リネーム
- 明らかなバグ修正（null例外、off-by-one）
- 自モジュール内のリファクタリング、テストコード追加

---

## セキュリティ必須事項

- ハードコードされたシークレット・APIキー禁止
- 環境変数は `.env.local`（開発）、Secret Manager（本番）
- ユーザー入力は必ずZodでバリデーション
- SQLインジェクション防止: Prismaパラメータ化クエリのみ
- XSS防止: `dangerouslySetInnerHTML` 禁止
- CSRF: Server Actionsは自動保護、Route Handlersは明示的対策
- 認証: middleware.tsでルートレベル保護
- 依存関係: `npm audit` でゼロ脆弱性維持

---

## Git コミット形式

- 形式: `<type>(<scope>): <日本語の説明>`
- type: `feat` / `fix` / `refactor` / `test` / `docs` / `chore` / `perf`
- 1コミット = 1つの論理的変更、動く状態でコミット

---

## オンデマンドルール参照先

作業対象に応じて `reference/` から必要なファイルを読み込むこと。参照テーブルは CLAUDE.md の Rules セクションを参照。
