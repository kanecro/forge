# Spec Interpretation: Task 3-5 /compound にレビューメトリクス蓄積を追加

## 対象要件
- Requirement: REQ-015 `/compound` のレビューメトリクス蓄積
  - **仕様の記述**:
    - GIVEN `reviews/review-summary.md` が存在する WHEN ステップ3.5 を実行する THEN P1/P2/P3/ノイズ候補、却下率、カバレッジ率を抽出し `docs/compound/metrics/review-metrics.md` に蓄積する
    - GIVEN 既存のメトリクスファイルがある WHEN メトリクスを蓄積する THEN 既存データに追記する
    - GIVEN メトリクスファイルが存在しない WHEN メトリクスを蓄積する THEN ディレクトリ含めて新規作成する
    - GIVEN `reviews/review-summary.md` が存在しない WHEN ステップ3.5 を実行する THEN スキップする
  - **私の解釈**:
    - ワークフローのステップ3（複利ドキュメント出力）の後にステップ3.5を挿入する
    - review-summary.md の存在チェックを先に行い、存在しない場合は即座にスキップ
    - メトリクスのフォーマットを定義し、追記形式で蓄積
  - **前提（仕様に未記載だが私が仮定すること）**:
    - メトリクスフォーマットは日付ベースのエントリを追記する表形式とする
    - 却下率はレビュアー別に記録する
    - review-summary.md のフォーマットは /review コマンドの出力に準拠
  - **仕様でカバーされないエッジケース**:
    - review-summary.md のフォーマットが想定と異なる場合: 抽出可能な情報のみ記録し、抽出不能な項目は「N/A」とする

## 実装判断

| 判断項目 | 選択肢 | 採用 | 根拠 | 却下理由 |
|---|---|---|---|---|
| ステップの挿入位置 | A: ステップ3の後（3.5）, B: ステップ4の後 | A | タスク説明に「ステップ3後にステップ3.5」と明記 | B: 仕様と矛盾 |
| メトリクス蓄積先 | 代替案なし -- 仕様が一意に指定 (`docs/compound/metrics/review-metrics.md`) | --- | --- | 代替案なし -- 仕様が一意に指定 |
| 蓄積方式 | A: 追記, B: 上書き | A | 仕様に「既存データに追記する」と明記 | B: 仕様と矛盾 |

## 必須チェック項目
- [x] 入力の有効値/無効値は何か？ → review-summary.md が存在するか否か。存在しない場合はスキップ
- [x] エラー時の振る舞いは？ → 該当なし（マークダウン定義のため）
- [x] 外部依存が失敗した場合は？ → 該当なし
- [x] 非同期処理の場合、競合状態への対処は？ → 該当なし

## ギャップ検出（エスカレーション候補）
- なし

---

## Phase B: 実装完了後の追記

### 変更ファイル一覧

#### 作成したファイル
- なし

#### 修正したファイル
- `~/.claude/commands/compound.md`: ワークフローにステップ3.5（レビューメトリクス蓄積）を追加。メトリクス定義、蓄積先、フォーマット、存在チェック・スキップ条件を定義

#### 削除したファイル
- なし

### 実装の振り返り
- 仕様の曖昧性への対処: 蓄積フォーマットは仕様に未記載だったため、日付+change-name をヘッダーとするテーブル形式を採用
- 却下した代替案: JSON形式での蓄積→マークダウンの可読性を優先
- 想定外の発見: 特になし
