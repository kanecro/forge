# Spec Interpretation: Task 1-4 forge-skill-orchestrator にファイルサフィックス判定を追加

## 対象要件
- Requirement: REQ-005 forge-skill-orchestrator のファイルサフィックス判定
  - **仕様の記述**:
    - GIVEN `/brainstorm` フェーズを検出する WHEN ドメイン Skill を呼び出す THEN スキル名に `/constraints` サフィックスを付与する
    - GIVEN `/spec` フェーズを検出する WHEN ドメイン Skill を呼び出す THEN スキル名に `/design` サフィックスを付与する
    - GIVEN `/implement` または `/review` フェーズを検出する WHEN ドメイン Skill を呼び出す THEN サフィックスなし（現行通り）
    - GIVEN Methodology Skills を呼び出す WHEN フェーズに関わらず THEN サフィックスを付けない
    - GIVEN サフィックス付きスキル名で指定されたファイルが存在しない WHEN Claude Code がスキルを解決する THEN SKILL.md にフォールバックし警告を出力する
  - **私の解釈**: フェーズ検出テーブルに「Domain Skill サフィックス」列を追加し、決定フローチャートのステップ3-7にサフィックス付与ロジックを組み込む。Sub Agent 向けテンプレートを2種類（Phase-Aware版とStandard版）に分離する。フォールバックセクションを新設する
  - **前提（仕様に未記載だが私が仮定すること）**:
    - `/test` フェーズと `/compound` フェーズはサフィックスなし（`/implement` と `/review` と同様、SKILL.md 全体を使用）。delta-spec が明示的にサフィックスを指定しているのは brainstorm と spec のみで、implement/review は「なし」と指定。test/compound/debug は言及がないが、実装寄りのフェーズなので SKILL.md 全体が妥当
    - `/ship` フェーズはフェーズ遷移ありのため、各段階で適切なサフィックスが適用される（既存の `/ship` の `all` フェーズ定義と同様）
  - **仕様でカバーされないエッジケース**:
    - バグ修正・エラー対応（debug フェーズ）のサフィックス: 実装寄りなのでサフィックスなしと判断
    - 設計・要件整理（design/spec フェーズ混在）のサフィックス: spec フェーズに寄せて `/design` を採用

- Requirement: REQ-M01 forge-skill-orchestrator のフェーズ検出テーブル拡張
  - **仕様の記述**:
    - GIVEN フェーズ検出テーブルを検証する WHEN 列構成を確認する THEN 「コマンド / 作業内容」「フェーズ」「Domain Skill サフィックス」の3列が存在する
    - GIVEN Sub Agent 向けテンプレートを検証する WHEN テンプレート数を確認する THEN Phase-Aware テンプレート（/brainstorm, /spec 用）と標準テンプレート（/implement, /review 用）の2つが存在する
  - **私の解釈**: テーブルの3列目を追加し、テンプレートセクションを2つに分離する
  - **前提**: テーブルの既存行を維持しつつ、3列目を追加する
  - **仕様でカバーされないエッジケース**: なし

## 実装判断

| 判断項目 | 選択肢 | 採用 | 根拠 | 却下理由 |
|---|---|---|---|---|
| フォールバックセクションの配置場所 | A: 決定フローチャート内, B: 独立セクション | B | task description に「フォールバックセクションを新設」と明記 | A: 仕様が「新設」を指定しており、既存フロー内への埋め込みは不適切 |
| debug/test/compound フェーズのサフィックス | A: サフィックスなし, B: フェーズに応じて付与 | A | delta-spec が brainstorm=constraints, spec=design, implement/review=なし のみ定義。他フェーズは実装寄り | B: 仕様に言及がないフェーズにサフィックスを推測で付与するのはリスク |
| Phase-Aware テンプレートの記法 | A: `<skill>/constraints` or `<skill>/design`, B: 明示的なファイルパス | A | delta-spec のシナリオが `prisma-expert/constraints`, `prisma-expert/design` という記法を使用 | B: Claude Code のスキル名解決方式と一致しないため |

> **却下理由の記載ルール:**
> - 採用しなかった選択肢について、それぞれ却下した理由を記述する

## 必須チェック項目
- [x] 入力の有効値/無効値は何か？ → フェーズ名はテーブルで定義済み。無効なフェーズの場合はサフィックスなし（安全なデフォルト）
- [x] エラー時の振る舞いは？ → サフィックス付きファイルが存在しない場合は SKILL.md にフォールバック + 警告出力（REQ-005 エラーシナリオで定義済み）
- [x] 外部依存が失敗した場合は？ → 該当なし（マークダウンファイルの編集のみ）
- [x] 非同期処理の場合、競合状態への対処は？ → 該当なし

## ギャップ検出（エスカレーション候補）
- なし（仕様が十分に明確）

---

## Phase B: 実装完了後の追記

### 変更ファイル一覧

#### 作成したファイル
- なし

#### 修正したファイル
- `~/.claude/skills/forge-skill-orchestrator/SKILL.md`: フェーズ検出テーブルにサフィックス列追加、サブエージェント向けテンプレートを Phase-Aware/Standard の2種に分離、フォールバック機構セクション新設、決定フローチャートにサフィックス付与ステップ追加、使用例をサフィックス反映版に更新

#### 削除したファイル
- なし

### 実装の振り返り
- 仕様の曖昧性への対処: `/test`, `/compound`, `debug` フェーズのサフィックスが delta-spec で明示されていなかったが、`/implement` と `/review` が「なし」と明記されている点と、これらのフェーズが実装寄りである点から、サフィックスなしと判断した
- 却下した代替案: フォールバック機構を決定フローチャートの中に埋め込む案を却下。タスク記述の「フォールバックセクションを新設」という指示に従い独立セクションとした
- 想定外の発見: 決定フローチャートのステップ番号がサフィックス付与ステップ挿入により 1つずつずれた（旧4-7 → 新5-8）。使用例も全てサフィックスの有無を明示するように更新し、コンテキスト効率の試算値も追加した
