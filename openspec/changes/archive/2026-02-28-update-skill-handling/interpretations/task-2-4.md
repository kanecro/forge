# Spec Interpretation: Task 2-4 /review コマンドに L1/L2 チェック（Step 0）を追加

## 対象要件
- Requirement: REQ-009
  - **仕様の記述**: GIVEN /review を実行する WHEN Step 0 を検証する THEN LLM レビュアー起動前に `npx tsc --noEmit` と `npx eslint --quiet` が実行される。GIVEN L1/L2 の結果が REVIEW CONTEXT に注入される WHEN LLM レビュアーがレビューする THEN L1/L2 で検出済みの問題と同一の指摘は行わず、高次の問題に集中する。
  - **私の解釈**: 既存の review.md の Step 1 の前に Step 0 を挿入する。Step 0 は L1（TypeScript 型チェック）と L2（ESLint 静的解析）の2つの自動チェックを実行し、結果を REVIEW CONTEXT に追加注入する。レビュアーにはこれらの結果が既に検出済みであることを伝え、同一の問題を重複して指摘しないよう指示する。
  - **前提（仕様に未記載だが私が仮定すること）**: Step 0 の結果は REVIEW CONTEXT の既存構造に追加する形で注入する。L1/L2 のエラーが検出されてもレビューフローは続行する（Error Scenario で明記）。Step 番号は既存の Step 1-7 を変更せず、Step 0 として挿入する。
  - **仕様でカバーされないエッジケース**: tsc や eslint がインストールされていない場合の挙動。対応: コマンド実行結果のエラーをそのまま記録し、レビューは続行する。

## 実装判断

| 判断項目 | 選択肢 | 採用 | 根拠 | 却下理由 |
|---|---|---|---|---|
| Step 0 の挿入位置 | A: Step 1 の直前に独立セクション | A | 仕様に「Step 1 の前に Step 0 を挿入」と明記。既存フローを変更しない | 代替案なし -- 仕様が一意に指定 |
| REVIEW CONTEXT への注入方法 | A: 既存 REVIEW CONTEXT テンプレートに追加, B: 別セクションとして分離 | A | 既存の REVIEW CONTEXT 構造に沿って追加することで一貫性を維持 | B: レビュアーが参照する際に二箇所見る必要があり非効率 |
| L1/L2 エラー時のフロー | A: 続行, B: 中断 | A | 仕様の Error Scenario に「レビューは続行する」と明記 | B: 仕様に反する |

## 必須チェック項目
- [x] 入力の有効値/無効値は何か？ → change-name は既存の引数解析ロジックで決定済み
- [x] エラー時の振る舞いは？ → L1/L2 でエラーが検出されてもレビューは続行する（仕様に明記）
- [x] 外部依存が失敗した場合は？ → tsc/eslint コマンド自体が失敗してもレビューは続行する
- [x] 非同期処理の場合、競合状態への対処は？ → 該当なし（逐次実行）

## ギャップ検出（エスカレーション候補）
- なし

---

## Phase B: 実装完了後の追記

### 変更ファイル一覧

#### 作成したファイル
- なし

#### 修正したファイル
- `~/.claude/commands/review.md`: Step 0（L1/L2 自動チェック）をワークフローの先頭に挿入。REVIEW CONTEXT テンプレートに L1/L2 結果と重複指摘防止指示を追加。

#### 削除したファイル
- なし

### 実装の振り返り
- 仕様の曖昧性への対処: 仕様は明確で曖昧性はなかった。Step 0 の挿入位置と REVIEW CONTEXT への注入方法はスペックから一意に決定できた。
- 却下した代替案: REVIEW CONTEXT を別セクションに分離する案を却下。一貫性を維持するため既存構造に追加する方式を採用した。
- 想定外の発見: 特になし。既存のワークフローは Step 1 から開始しており、Step 0 の挿入は自然な形で行えた。
