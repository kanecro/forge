# Spec Interpretation: Task 3-6 /brainstorm に constraints.md 参照を追加

## 対象要件
- Requirement: REQ-016 `/brainstorm` の constraints.md 参照
  - **仕様の記述**:
    - GIVEN 要件が十分に固まった段階 WHEN ステップ5.5 を実行する THEN 対象領域からドメインを推論し、該当ドメイン Skill の constraints.md を参照し、要件と制約の矛盾をチェックする
    - GIVEN 矛盾が検出される WHEN ユーザーに報告する THEN 「この要件は技術的制約 [X] と矛盾する可能性があります」と伝え、要件の修正を検討するよう提案する
    - GIVEN 提案書を出力する WHEN 制約が検出されている THEN 「技術的考慮事項」セクションに関連制約を記載する
    - GIVEN constraints.md が存在しない Skill WHEN ステップ5.5 を実行する THEN スキップする
    - GIVEN 矛盾が検出されるが、ユーザーが「そのまま進める」と判断する WHEN チェック結果を確認する THEN ブロッキングではないため許可する
  - **私の解釈**:
    - 既存ステップ5（提案書出力）の前にステップ5.5を挿入する
    - 対象領域からドメインを推論する（proposal.md の対象領域セクションを活用）
    - constraints.md のみ参照、design.md は参照しない（仕様の Non-Functional Requirements に明記）
    - ブロッキングではない（ユーザーが無視して進めることが可能）
    - 提案書テンプレートに「技術的考慮事項」セクションを追加
  - **前提（仕様に未記載だが私が仮定すること）**:
    - ドメイン推論は対象領域のキーワードから行う（DB関連→prisma-expert等）
    - 複数のドメインに該当する場合は全ての constraints.md を参照する
  - **仕様でカバーされないエッジケース**:
    - 対象領域が特定のドメインに該当しない場合: constraints.md チェックをスキップ

## 実装判断

| 判断項目 | 選択肢 | 採用 | 根拠 | 却下理由 |
|---|---|---|---|---|
| ステップ挿入位置 | 代替案なし -- 仕様が一意に指定（5.5） | --- | --- | 代替案なし -- 仕様が一意に指定 |
| 参照対象 | A: constraints.md のみ, B: constraints.md + design.md | A | 仕様に「constraints.md のみ参照し design.md は参照しない」と明記 | B: 仕様と矛盾 |
| ブロッキング動作 | A: ブロッキング, B: 非ブロッキング | B | 仕様に「ブロッキングではない」と明記 | A: 仕様と矛盾 |

## 必須チェック項目
- [x] 入力の有効値/無効値は何か？ → 対象領域のキーワードからドメイン推論。該当なしの場合はスキップ
- [x] エラー時の振る舞いは？ → constraints.md が存在しない場合はスキップ
- [x] 外部依存が失敗した場合は？ → 該当なし
- [x] 非同期処理の場合、競合状態への対処は？ → 該当なし

## ギャップ検出（エスカレーション候補）
- なし

---

## Phase B: 実装完了後の追記

### 変更ファイル一覧

#### 作成したファイル
- なし

#### 修正したファイル
- `~/.claude/commands/brainstorm.md`: ステップ5.5（技術的制約チェック）を追加。ドメイン推論、constraints.md参照、矛盾チェック、非ブロッキング動作を定義。提案書テンプレートに「技術的考慮事項」セクションを追加

#### 削除したファイル
- なし

### 実装の振り返り
- 仕様の曖昧性への対処: ステップ番号のリナンバリング（元の5→5、元の6→6,7）により既存フローとの整合性を維持
- 却下した代替案: 提案書テンプレートに常に「技術的考慮事項」を必須にする→制約が検出されなかった場合は省略可とした（仕様の「ステップ5.5 で制約が検出された場合のみ」に準拠）
- 想定外の発見: 特になし
